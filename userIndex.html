<!-- 前端界面---主界面 -->
<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>gps云监控平台</title>
    <script type="text/javascript" src="./js/echarts.min.js"></script>
    <script type="text/javascript" src="./js/china.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <!-- 加载高德地图安全密匙 -->
    <script type="text/javascript">
        window._AMapSecurityConfig = {
            securityJsCode: "f438fc4e98b2a10ae198e0dc1e118069",
        }
    </script>
    <!-- 引入layui -->
    <link href="https://www.layuicdn.com/layui/css/layui.css" rel="stylesheet">
    <script src="//cdn.staticfile.org/layui/2.8.18/layui.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <link rel="stylesheet" href="css/pageCss/userIndex.css">
    <!-- 加载高德地图key -->
    <script src="https://webapi.amap.com/maps?v=2.0&key=6f9fa6e44e6237a877b698dbb9d5ce3d"></script>
</head>

<body class="index_body">

    <div class="layui-row">
        <div class="layui-col-xs5">
            <div class="title_up_line"></div>
        </div>
        <div class="layui-col-xs2">
            <h3 class="index_title">gps云监控平台</h3>
        </div>
        <div class="layui-col-xs5">
            <div class="title_up_line" style="margin-left: 3px;"></div>
        </div>
    </div>

    <div class="layui-row">
        <div class="layui-col-xs4">
            &nbsp;
        </div>
        <div class="layui-col-xs3">
            <div class="title_up_tran45_left_line"></div>
            <div class="title_up_tran0_line"> </div>
            <div class="title_up_tran45_right_line"></div>
        </div>
        <div class="layui-col-xs6">
            &nbsp;
        </div>
        <div class="layui-col-xs2">
            <p class="date_show"> 日期时间：2024-5-21 10:14:15</p>
        </div>
    </div>

    <div class="layui-row" style="margin-top: 30px;margin-left: 10px;">
        <div class="layui-col-xs4">
            <div class="content-box box-4x-height">
                <p class="box-title">>> 运行路线查询</p>
                <div class="layui-form">
                    <div style="width: 300px;margin-left: 45px;">
                        <select>
                            <option value="1">gps测试1号</option>
                            <option value="1">gps测试2号</option>
                        </select>
                    </div>
                    <div style="width: 350px;margin-left: 45px;margin-top: 15px;">
                        <div class="layui-input-inline layui-input-wrap" style="width: 150px;">
                            <div class="layui-input-prefix" style="margin: -5px;">
                                <i class="layui-icon layui-icon-date"></i>
                            </div>
                            <input type="text" name="date" id="beginDate" lay-verify="date" placeholder="开始时间"
                                autocomplete="off" class="layui-input">
                        </div>
                        <div class="layui-input-inline layui-input-wrap" style="width: 150px;">
                            <div class="layui-input-prefix" style="margin: -5px;">
                                <i class="layui-icon layui-icon-date"></i>
                            </div>
                            <input type="text" name="date" id="endDate" lay-verify="date" placeholder="结束时间"
                                autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div style="margin-left: 45px;margin-top: 15px;">
                        <button type="button" class="layui-btn layui-btn-radius layui-btn-normal"
                            style="margin-left: 50px;">查询</button>
                        <button type="button" class="layui-btn layui-btn-radius layui-bg-orange"
                            style="margin-left: 40px;">重置</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-xs8">
            <div class="content-box box-4x-height" style="width: 95%;">
                <p class="box-title">>> 数据统计</p>
                <div class="layui-row">

                    <div class="layui-col-xs4">
                        <div class="data_total_box">
                            <p class="data_total_title">gps绑定数量：</p>
                            <p class="data_total_data">1</p>
                        </div>
                    </div>
                    <div class="layui-col-xs4">
                        <div class="data_total_box">
                            <p class="data_total_title">gps地理数据：</p>
                            <p class="data_total_data">6534</p>
                        </div>
                    </div>
                    <div class="layui-col-xs4">
                        <div class="data_total_box">
                            <p class="data_total_title">大屏使用次数：</p>
                            <p class="data_total_data">10</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-row" style="margin-top: 20px;margin-left: 10px;">
        <div class="layui-col-xs4">
            <div class="content-box box-3x-width box-6x-height">
                <p class="box-title">>> 实时数据</p>
                <div class="gpsdata-content">
                    <div class="gps-data">
                        <p class="gpsdata-font-time">2024-05-21 09:00:00</p>
                        <p class="gpsdata-font-data">【测试1号gps】 位于(120.345667,73.539158)</p>
                    </div>
                    <div class="gps-data">
                        <p class="gpsdata-font-time">2024-05-20 15:30:00</p>
                        <p class="gpsdata-font-data">【测试2号gps】 位于(120.123456,73.987654)</p>
                    </div>
                    <div class="gps-data">
                        <p class="gpsdata-font-time">2024-05-19 12:45:00</p>
                        <p class="gpsdata-font-data">【测试3号gps】 位于(120.654321,73.246802)</p>
                    </div>
                    <div class="gps-data">
                        <p class="gpsdata-font-time">2024-05-18 08:20:00</p>
                        <p class="gpsdata-font-data">【测试4号gps】 位于(120.111222,73.333444)</p>
                    </div>
                    <div class="gps-data">
                        <p class="gpsdata-font-time">2024-05-17 14:10:00</p>
                        <p class="gpsdata-font-data">【测试5号gps】 位于(120.999888,73.777666)</p>
                    </div>
                    <div class="gps-data">
                        <p class="gpsdata-font-time">2024-05-17 14:10:00</p>
                        <p class="gpsdata-font-data">【测试5号gps】 位于(120.999888,73.777666)</p>
                    </div>
                    <div class="gps-data">
                        <p class="gpsdata-font-time">2024-05-17 14:10:00</p>
                        <p class="gpsdata-font-data">【测试5号gps】 位于(120.999888,73.777666)</p>
                    </div>
                    <div class="gps-data">
                        <p class="gpsdata-font-time">2024-05-17 14:10:00</p>
                        <p class="gpsdata-font-data">【测试5号gps】 位于(120.999888,73.777666)</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-xs8">
            <div class="content-box box-7x-width box-6x-height" style="width: 97%;padding: 0px;height: 380px;">
                <div id="container" style="width: 100%;height: 100%;color: black;"></div>
            </div>
        </div>
    </div>



</body>

<script>
    // layui初始化
    layui.use(['form', 'laydate', 'util'], function () {
        var form = layui.form;
        var layer = layui.layer;
        var laydate = layui.laydate;
        var util = layui.util;
        laydate.render({
            elem: ['#beginDate', '#endDate']
        });
    })

    var map;
    // 确保在页面加载完成后再执行JavaScript代码
    window.onload = function () {
        // 调用map()函数初始化地图
        map();

        // 每秒钟调用一次loadMark函数
        setInterval(function () {
            loadMark(map);
        }, 1000);
    }

    function map() {

        //初始化地图
        map = new AMap.Map('container', {
            viewMode: '3D',  // 默认使用 2D 模式
            zoom: 17,  //初始化地图层级
            pitch: 45,
            center: [120.471077, 31.582275]  //初始化地图中心点
        });


        //安装地图插件
        AMap.plugin(["AMap.GeoJSON", "AMap.MoveAnimation", "AMap.ToolBar", "AMap.Scale", "AMap.ControlBar", "AMap.MapType"], function () {
            //缩略按钮插件
            map.addControl(new AMap.ToolBar({
                position: {
                    top: '180px',
                    right: '40px'
                }
            }))
            //比例尺显示插件
            map.addControl(new AMap.Scale())
            //观察角度插件
            map.addControl(new AMap.ControlBar())
            //地图图层切换插件
            map.addControl(new AMap.MapType({
                defaultType: 1, // 0表示默认底图，1表示卫星图
                showRoad: true // 显示路网
            }))
        })


        // 3d楼层
        var buildingsD = new AMap.Buildings;
        map.add(buildingsD)

        //初始化点标注
        loadMark(map);

    }



    //初始化所有点标注(即获取所有geojson并转化为地图上的点)
    function loadMark() {
        getData().then(result => {
            console.log(result);
            var jingdu = result.data.jingdu;
            var weidu = result.data.weidu;

            console.log(jingdu);
            console.log(weidu);

            map.clearMap();

            // 创建新的标记
            var marker = new AMap.Marker({
                position: [jingdu, weidu],
                map: map
            });

            map.setCenter([jingdu, weidu]);
        }).catch(error => {
            console.error('Failed to load ', error);
        });
    }

    //获取数据---向后端获取数据
    function getData() {
        return new Promise((resolve, reject) => {
            axios.get('http://121.37.39.206:8458/gps/getNowGpsData', {
                withCredentials: true,
                headers: {
                    'Access-Control-Allow-Origin': '*'
                }
            }).then(function (response) {
                if (response.data.code === 200) {
                    resolve(response.data);
                } else {
                    console.log(response.data);
                    resolve(false);
                }
            }).catch(function (error) {
                console.error('Request failed:', error);
                reject(error);
            });
        });
    }
</script>